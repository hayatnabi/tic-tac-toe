<div style="height: 100vh; display: flex; align-items: center; justify-content: center;">
  <div class="card z-depth-4" style="padding: 30px; max-width: 450px; width: 100%; text-align: center; border-radius: 16px; box-shadow: 0 0 25px rgba(0, 150, 136, 0.7);">
    <div class="center-align" style="margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 15px;">
      <img src="https://upload.wikimedia.org/wikipedia/commons/3/32/Flag_of_Pakistan.svg"
       alt="Pakistani Flag"
       width="50"
       style="border: 1px solid #ccc; border-radius: 4px;" />
      <h5 class="teal-text text-darken-3" style="margin: 0;">PAF vs IAF.....6-Nil üòé</h5>
    </div>
    <%# <h5 class="teal-text text-darken-3">Tic Tac Toe</h5> %>
    <% if session[:game_over] %>
      <div class="card-panel teal lighten-2 white-text" style="padding: 5px; border-radius: 12px;">
        <% if @message.present? %>
          <p class="flow-text" style="margin: 0;">
            <strong><%= @message %></strong>
          </p>
        <% end %>
        <%# <% else %>
        <p class="flow-text" style="margin: 0;">
          <strong>Game Over!</strong>
        </p>
        <div class="section" style="margin-top: 10px;">
          <div style="display: flex; justify-content: center;">
            <div class="center-align">
              <%= button_to reset_game_path,
                method: :post,
                class: 'btn white teal-text text-darken-3 waves-effect z-depth-1',
                form: { style: 'display: inline' },
                style: 'border: 2px solid white; border-radius: 12px; padding: 10px 20px; font-weight: normal; display: flex; align-items: center; justify-content: center;' do %>
                ‚ñ∑&nbsp;Play Again
              <% end %>
            </div>
          </div>
        </div>
        <% if @message != "It's a tie!"%>
          <button onclick="document.getElementById('my-audio').play()" class="btn green lighten-2 white-text" style="display: none;">
            üì¢ Listen PAK Victory? Click me!
          </button>
        <% end %>
        <!-- Game Over Sound -->
        <%# <audio controls>
          <source src="/audio/game_over3_trimmed.mp3" type="audio/mpeg">
          Your browser does not support the audio element.
        </audio> %>
        <script>
          document.getElementById('my-audio').play()
        </script>
        <audio id="my-audio" src="/audio/game_over_115s.mp3" style="display: none;"></audio>
      </div>
    <% else %>
      <p class="flow-text"><strong>Player <%= @current_player %>'s turn</strong></p>
    <% end %>
    <%= form_with url: game_move_path, method: :post, local: true do %>
      <div style="position: relative; width: 306px; height: 306px; margin: auto; background: white;">
        <%# Horizontal lines %>
        <div style="position: absolute; top: 102px; left: 0; width: 100%; height: 2px; background: black;"></div>
        <div style="position: absolute; top: 204px; left: 0; width: 100%; height: 2px; background: black;"></div>
        <%# Vertical lines %>
        <div style="position: absolute; left: 102px; top: 0; height: 100%; width: 2px; background: black;"></div>
        <div style="position: absolute; left: 204px; top: 0; height: 100%; width: 2px; background: black;"></div>
        <% 9.times do |index| %>
          <% row = index / 3 %>
          <% col = index % 3 %>
          <% top = row * 102 %>
          <% left = col * 102 %>
          <% cell = @board[index] %>
          <% disabled = cell.present? || session[:game_over] %>
          <% btn_style = "position: absolute; top: #{top}px; left: #{left}px; width: 100px; height: 100px; color: black; font-size: 32px; border: none; background: none;" %>
          <% if disabled %>
            <%# class="z-depth-3" %>
            <button disabled style="<%= btn_style %>">
              <%= cell %>
            </button>
          <% else %>
            <button type="submit"
                name="cell"
                value="<%= index %>"
                style="<%= btn_style %>; cursor: pointer;">
              &nbsp;
            </button>
          <% end %>
        <% end %>
      </div>
    <% end %>
    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 35px;">
      <%= button_to root_path, method: :get, class: 'btn-back btn waves-effect waves-light blue darken-2 white-text', form: { style: 'display: inline' } do %>
        <span style="display: flex; align-items: center; justify-content: center; height: 100%; width: 100%; font-weight: bold;">
          „Åè&nbsp;Back
        </span>
      <% end %>
      <%= button_to reset_game_path, method: :post, class: 'btn-reset-game btn waves-effect waves-light red lighten-2 white-text', form: { style: 'display: inline' } do %>
        <span style="display: flex; align-items: center; justify-content: center; height: 100%; width: 100%; font-weight: bold;">
          ‚Ü∫&nbsp;Reset Game
        </span>
      <% end %>
    </div>
  </div>
  <!-- Background animation layer -->
  <div id="xo-background">
    <% 50.times do %>
      <% char = ['X', 'O', 'üí•', 'üõ¶', 'üí•üöÄ'].sample %>
      <% top = rand %>
      <% left = rand %>
      <% delay = rand %>
      <% size = [12, 14, 16, 18, 20].sample %>
      <span class="xo" style="
      --rand-top: <%= top %>;
      --rand-left: <%= left %>;
      --rand-delay: <%= delay %>;
      font-size: <%= size %>px;
    "><%= char %></span>
    <% end %>
  </div>
  <style>
    #xo-background {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 0;
      pointer-events: none;
    }

    #xo-background .xo {
      position: absolute;
      font-weight: bold;
      color: rgba(0, 0, 0, 0.2);
      top: calc(100% * var(--rand-top));
      left: calc(100% * var(--rand-left));
      animation: floatXO 25s linear infinite;
      animation-delay: calc(-25s * var(--rand-delay));
    }

    @keyframes floatXO {
      0% {
        transform: translateY(0) scale(1) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(-120vh) scale(1.2) rotate(360deg);
        opacity: 0;
      }
    }

    .btn-reset-game {
        border-radius: 12px;
        padding: 8px 20px;
        font-weight: bold;
        box-shadow: 0 4px 10px rgba(239, 83, 80, 0.4);
        transition: background 0.3s ease;
    }

    .btn-back {
        border-radius: 12px;
        padding: 8px 20px;
        font-weight: bold;
        box-shadow: 0 4px 10px rgba(80, 149, 239, 0.4);
        transition: background 0.3s ease;
    }
  </style>
</div>
